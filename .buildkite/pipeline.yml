steps:
  - label: Test
    key: test
    env:
      NODE_ENV: test
    plugins:
      - $NVM_PLUGIN
    command: |
      npm ci
      npm run build
      npm test

  - label: Lint
    key: lint
    env:
      NODE_ENV: test
    plugins:
      - $NVM_PLUGIN
    command: |
      npm ci
      npm run build
      npm run lint

  - label: Build
    key: build
    plugins:
      - $NVM_PLUGIN
    command: |
      sudo dpkg --add-architecture i386
      sudo apt update
      sudo apt -y install libxkbfile-dev libxkbfile-dev:i386 libxext-dev libx11-dev libx11-dev:i386 libxss-dev gcc-multilib g++-multilib rpm
      npm ci
      make build

  - label: Test code signing fetching
    agents:
      queue: mac
    env:
      IMAGE_ID: $IMAGE_ID
    plugins:
      - $CI_TOOLKIT_PLUGIN
      - $NVM_PLUGIN
    command: |
      npm ci
      make package-osx
